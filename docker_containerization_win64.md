
## Creating Docker Images on Win64  
  
Below are steps to create a Docker image for a machine learning (ML) environment intended for scaling ML workflows.  
  
1. Download and install the [Docker community edition on Windows](https://docs.docker.com/docker-for-windows/install/)       
   ***Note***: Windows editions 8.1 or lower will need to install the legacy version of Docker from [here](https://docs.docker.com/toolbox/overview/)
2. Start the **Docker Quick Start Terminal** (DQST) using the shortcut created as part of (1) above.  
3. Sanity test the Docker installation using DQST by following this [guide](https://docs.docker.com/get-started/#test-docker-version). If the test is successful you should see the following output on the terminal:  
```  
$ docker run hello-world  
Hello from Docker!  
This message shows that your installation appears to be working correctly.  
To generate this message, Docker took the following steps:  
 1. The Docker client contacted the Docker daemon.  
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.  
    (amd64)  
 3. The Docker daemon created a new container from that image which runs the  
    executable that produces the output you are currently reading.  
 4. The Docker daemon streamed that output to the Docker client, which sent it  
    to your terminal.  
To try something more ambitious, you can run an Ubuntu container with:  
 $ docker run -it ubuntu bash  
Share images, automate workflows, and more with a free Docker ID:  
 https://hub.docker.com/  
For more examples and ideas, visit:  
 https://docs.docker.com/engine/userguide/  
```   
4. Create a **Dockerfile** for the scalable ML development environment which you intend to containerize. Take a look at this [guide](https://docs.docker.com/get-started/part2/#your-new-development-environment). Best practices for writing Dockerfiles are [here](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/).  
5. Build the Docker Image. ***Note***: Images can be created from scratch (i.e.:without building on another pre-existing image) or by building on top of another image, usually referred to as the parent image. The former results in what are known as base images. More on base and parent images [here](https://docs.docker.com/develop/develop-images/baseimages/).  
   * These were the specific steps taken to create the `scalable-ml-01` image  
     * activate scalable-ml-venv # Anaconda virtual environment with required dev packages  
     * mkdir scalable-ml-01 & cd scalable-ml-01  
     * pip freeze > requirements.txt  
     * Copy any python scripts or Jupyter notebooks (containing functionality that you want to scale) to this directory  
     * mkdir data  
     * copy all the data files needed by your Python implementation under `data`  
     * docker build -t `<image-name>` .  
       If successful, you should see these messages on the console for each command listed in the Dockerfile:  
       ```
       Sending build context to Docker daemon  36.02MB
       Step 1/9 : FROM continuumio/anaconda3
         ---> 7b0360c8bc31
       Step 2/9 : MAINTAINER Your Name <yourname@email.com>
         ---> Using cache
         ---> 77631409b073
       Step 3/9 : RUN mkdir dask-ml
         ---> Running in 77ba2a3cd69f
       Removing intermediate container 77ba2a3cd69f
         ---> a60b7e710033
       Step 4/9 : COPY requirements.txt /dask-ml/requirements.txt
         ---> d35c6b0a1658
       . . .
       Step 8/9 : RUN pip install dask-searchcv
         ---> Running in f4580744099d
       Collecting dask-searchcv
       . . .
       Successfully built 2f002b7de40b
       Successfully tagged scalable-ml-01:latest
       ```  
       ***Note***: After building the image for the first time, subsequent builds should take less time since any parent images have already been downloaded and will not need to re-downloaded.
     * Check that the image is present by running `docker images`.   
        ```
        $ docker images
        REPOSITORY              TAG                 IMAGE ID            CREATED
            SIZE
        scalable-ml-01          latest              2f002b7de40b        10 minutes ago
            3.24GB
        hello-world             latest              e38bc07ac18e        3 weeks ago
            1.85kB
        continuumio/anaconda3   latest              7b0360c8bc31        5 weeks ago
            3.2GB
        ```
6. Run the docker image locally to sanity test it as below. Additional information on the `run` command is [here](https://docs.docker.com/engine/reference/run/). Also useful is [this excellent post](https://www.ctl.io/developers/blog/post/dockerfile-entrypoint-vs-cmd/).    
   ***Note***: It is considered good practice to specify an explicit container name so one can avoid having to deal with a complex alphanumeric IDs generated by default.  
  
   `docker run --name <container-name> -t <image-name> <optional-arguments>`     
    ```
    $docker run --name dask-ml-inst -t scalable-ml-01 "127.0.0.1"  
    Starting cluster at 127.0.0.1:8786```
    
    A successful run should result in the container listed as below:    
    ```
    $ docker ps -l
    CONTAINER ID        IMAGE               COMMAND                  CREATED
         STATUS                      PORTS               NAMES
    1e7c53fdd679        2f002b7de40b        "/usr/bin/tini -- py"   12 minutes ago
        Exited (1) 12 minutes ago                       dask-ml-inst
    ```

Now that the image is sanity tested it can be tagged and uploaded to the cloud, either a registry like [**DockerHub**](https://hub.docker.com/) or [Amazon ECR](https://aws.amazon.com/ecr/).  
  
A list of frequently used Docker operations can be found in this [**cheetsheet**](https://www.docker.com/sites/default/files/Docker_CheatSheet_08.09.2016_0.pdf).  
